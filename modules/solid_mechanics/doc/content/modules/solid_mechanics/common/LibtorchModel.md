# LibtorchModel

!alert note
This is a custom [NEML2](solid_mechanics/NEML2.md) object for solid_mechanics. To enable it, configure MOOSE with libtorch and initialize the [NEML2 submodule](https://github.com/applied-material-modeling/neml2).

The documentation is for a NEML2 [!citep](neml2osti, neml2_anl_report) material for evaluating pretrained libtorch models in `.pt` format, such as neural networks. This allows evaluating models with an arbitrary number of inputs and mapping them to an arbitrary number of outputs.

## Example Input File

Running NEML2 models using MOOSE requires a separate NEML2 input file that builds the material. An example input for a NEML2 LibtorchModel is shown below. The inputs to the libtorch model are provided using `inputs = 'forces/T'`, and the model outputs are mapped to `outputs = 'state/k_T'`. The scaling of inputs and outputs is built into the libtorch model during training.

!listing test/tests/neml2/models/libtorch_model.i block=Models/rom

The evaluated NEML2 variable value `state/k_T` can then be mapped back to a MOOSE material property as shown in the following input file. The NEML2 input file is specified inside the `NEML2` block. We specify which NEML2 model to use (`model = 'rom'`), and specify that we want to map the non-linear `T` variable in MOOSE to the `forces/T` NEML2 variable, and the `state/k_T` NEML2 variable is mapped back to the `k_T` MOOSE material property (which is automatically generated by the action). NEML2 also uses automatic differenciation on the libtorch model to provide arbitrary derivatives of the outputs in relation to the inputs. Here we specify that we want to calculate $\frac{dk_T}{dT}$ to populate the Jacobian in a heat conduction example problem.

!listing test/tests/neml2/heat_conduction.i block=NEML2

!bibtex bibliography